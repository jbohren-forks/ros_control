<title>control_toolbox: pid_tests.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">pid_tests.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="pid__tests_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;ros/ros.h&gt;</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;<a class="code" href="pid_8h.html">control_toolbox/pid.h</a>&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;boost/math/special_functions/fpclassify.hpp&gt;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">using namespace </span>control_toolbox;
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="pid__tests_8cpp.html#a42fe8ac9715ee4d5c0746b0944082341">00012</a> <a class="code" href="pid__tests_8cpp.html#a42fe8ac9715ee4d5c0746b0944082341">TEST</a>(ParameterTest, zeroITermBadIBoundsTest)
<a name="l00013"></a>00013 {
<a name="l00014"></a>00014   RecordProperty(<span class="stringliteral">&quot;description&quot;</span>,<span class="stringliteral">&quot;This test checks robustness against divide-by-zero errors when given integral term bounds which do not include 0.0.&quot;</span>);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016   <a class="code" href="classcontrol__toolbox_1_1Pid.html" title="A basic pid class.">Pid</a> pid(1.0, 0.0, 0.0, -1.0, 0.0);
<a name="l00017"></a>00017 
<a name="l00018"></a>00018   <span class="keywordtype">double</span> cmd = 0.0;
<a name="l00019"></a>00019   <span class="keywordtype">double</span> pe,ie,de;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00022"></a>00022   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00023"></a>00023   EXPECT_FALSE(boost::math::isinf(ie));
<a name="l00024"></a>00024   EXPECT_FALSE(boost::math::isnan(cmd));
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00027"></a>00027   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00028"></a>00028   EXPECT_FALSE(boost::math::isinf(ie));
<a name="l00029"></a>00029   EXPECT_FALSE(boost::math::isnan(cmd));
<a name="l00030"></a>00030 }
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="pid__tests_8cpp.html#af8ae024d6fa58ba90dfa5dae8ba6e22a">00032</a> <a class="code" href="pid__tests_8cpp.html#a42fe8ac9715ee4d5c0746b0944082341">TEST</a>(ParameterTest, integrationWindupTest)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   RecordProperty(<span class="stringliteral">&quot;description&quot;</span>,<span class="stringliteral">&quot;This test succeeds if the integral error is prevented from winding up when the integral gain is non-zero.&quot;</span>);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   <a class="code" href="classcontrol__toolbox_1_1Pid.html" title="A basic pid class.">Pid</a> pid(0.0, 1.0, 0.0, 1.0, -1.0);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="keywordtype">double</span> cmd = 0.0;
<a name="l00039"></a>00039   <span class="keywordtype">double</span> pe,ie,de;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00042"></a>00042   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00043"></a>00043   EXPECT_EQ(-1.0, ie);
<a name="l00044"></a>00044   EXPECT_EQ(1.0, cmd);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00047"></a>00047   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00048"></a>00048   EXPECT_EQ(-1.0, ie);
<a name="l00049"></a>00049   EXPECT_EQ(1.0, cmd);
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="pid__tests_8cpp.html#a94035826aa4ab56a9696b1f0c7434461">00052</a> <a class="code" href="pid__tests_8cpp.html#a42fe8ac9715ee4d5c0746b0944082341">TEST</a>(ParameterTest, integrationWindupZeroGainTest)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   RecordProperty(<span class="stringliteral">&quot;description&quot;</span>,<span class="stringliteral">&quot;This test succeeds if the integral error is prevented from winding up when the integral gain is zero. If the integral error is allowed to wind up while it is disabled, it can cause sudden jumps to the minimum or maximum bound in control command when re-enabled.&quot;</span>);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <span class="keywordtype">double</span> i_gain = 0.0;
<a name="l00057"></a>00057   <span class="keywordtype">double</span> i_min = -1.0;
<a name="l00058"></a>00058   <span class="keywordtype">double</span> i_max = 1.0;
<a name="l00059"></a>00059   <a class="code" href="classcontrol__toolbox_1_1Pid.html" title="A basic pid class.">Pid</a> pid(0.0, i_gain, 0.0, i_max, i_min);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="keywordtype">double</span> cmd = 0.0;
<a name="l00062"></a>00062   <span class="keywordtype">double</span> pe,ie,de;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00065"></a>00065   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00066"></a>00066   EXPECT_LE(i_min, ie);
<a name="l00067"></a>00067   EXPECT_LE(ie, i_max);
<a name="l00068"></a>00068   EXPECT_EQ(0.0, cmd);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   cmd = pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a3b67ef1db5948f1da331e54171c2667e" title="Update the Pid loop with nonuniform time step size.">updatePid</a>(-1.0, ros::Duration(1.0));
<a name="l00071"></a>00071   pid.<a class="code" href="classcontrol__toolbox_1_1Pid.html#a71f8db012a3b70b4ada0e3d70ee851dc" title="Return PID error terms for the controller.">getCurrentPIDErrors</a>(&amp;pe,&amp;ie,&amp;de);
<a name="l00072"></a>00072   EXPECT_LE(i_min, ie);
<a name="l00073"></a>00073   EXPECT_LE(ie, i_max);
<a name="l00074"></a>00074   EXPECT_EQ(0.0, cmd);
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="pid__tests_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">00077</a> <span class="keywordtype">int</span> <a class="code" href="pid__tests_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
<a name="l00078"></a>00078   testing::InitGoogleTest(&amp;argc, argv);
<a name="l00079"></a>00079   <span class="keywordflow">return</span> RUN_ALL_TESTS();
<a name="l00080"></a>00080 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://ros.org/wiki/control_toolbox">control_toolbox</a><br />
Author(s): Melonee Wise, Sachin Chitta, John Hsu</br />
<small>autogenerated on Fri Feb 15 2013 10:35:59</small>
</div>
</body>
</html>
